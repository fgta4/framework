/**
 * fgta4 form v1.1.js
 * basic fungsional dari form entrian di fgta4
 *
 * minified tool by https://minify-js.com/
 * Agung Nugroho <agung@ferrine.com> http://www.ferrine.com
 * Jakarta, 10 September 2024
 *
 */

export function fgta4form(t,e){let a=this;return a.options=e,a.ITEMS={},a.MAPPING={},a.form=t,a.buttons={edit:null!=e.btn_edit&&null!=e.btn_edit?e.btn_edit:$("<a></a>").linkbutton({}),save:null!=e.btn_save&&null!=e.btn_save?e.btn_save:$("<a></a>").linkbutton({}),delete:null!=e.btn_delete&&null!=e.btn_delete?e.btn_delete:$("<a></a>").linkbutton({})},a.viewonly=!1,a.datachanged=!1,a.isnewdata=!1,a.primary=e.primary,a.errordiv=t[0].id+"-fgta4errordiv",a.eventsuspended=!1,a.datachangemessage="<div>Data Berubah, Apakah anda akan <b>membatalkan</b> perubahan ?</div>",a.OnNewDataCanceled="function"==typeof a.options.OnNewDataCanceled?a.options.OnNewDataCanceled:async()=>{},a.OnDataSaving="function"==typeof a.options.OnDataSaving?a.options.OnDataSaving:async()=>{},a.OnDataSaveError="function"==typeof a.options.OnDataSaveError?a.options.OnDataSaveError:async()=>{},a.OnDataSaved="function"==typeof a.options.OnDataSaved?a.options.OnDataSaved:async()=>{},a.OnDataDeleting="function"==typeof a.options.OnDataDeleting?a.options.OnDataDeleting:async()=>{},a.OnDataDeleted="function"==typeof a.options.OnDataDeleted?a.options.OnDataDeleted:async()=>{},a.OnIdSetup="function"==typeof a.options.OnIdSetup?a.options.OnIdSetup:async()=>{},a.OnViewModeChanged="function"==typeof a.options.OnViewModeChanged?a.options.OnViewModeChanged:async()=>{},a.OnFormInit="function"==typeof a.options.OnFormInit?a.options.OnFormInit:()=>{},a.OnRecordStatusCreated="function"==typeof a.options.OnRecordStatusCreated?a.options.OnRecordStatusCreated:()=>{},a.OnAboutCreated="function"==typeof a.options.OnAboutCreated?a.options.OnAboutCreated:()=>{},a.OnGettingData="function"==typeof a.options.OnGettingData?a.options.OnGettingData:()=>{},a.recordstatus={_createby:"",_createby_username:"",_createdate:null,_modifyby:"",_modifyby_username:"",_modifydate:null},a.form.form({onChange:()=>{form_changed(a)}}),"function"!=typeof a.buttons.edit.linkbutton&&(a.buttons.edit.linkbutton=t=>{}),"function"!=typeof a.buttons.save.linkbutton&&(a.buttons.save.linkbutton=t=>{}),"function"!=typeof a.buttons.delete.linkbutton&&(a.buttons.delete.linkbutton=t=>{}),a.buttons.edit.linkbutton({toggle:!0,onClick:()=>{btn_edit_click(a)}}),a.buttons.save.linkbutton({onClick:()=>{btn_save_click(a)}}),a.buttons.delete.linkbutton({onClick:()=>{btn_delete_click(a)}}),a.customaboutinfo=[],a.fgta4form={get ITEMS(){return a.ITEMS},get primary(){return a.primary},get autoid(){return a.options.autoid},setAutoId:t=>{a.options.autoid=t},getDefaultPrompt:t=>t?{value:null,text:"-- PILIH --"}:{value:"--NULL--",text:"NONE"},getDataChangeMessage:()=>a.datachangemessage,setDataChangeMessage:t=>{a.datachangemessage=t},setDisable:(t,e)=>setDisable(a,t,e),getCurrentId:()=>getCurrentId(a),setValue:(t,e,o)=>setValue(a,t,e,o),getValue:t=>getValue(a,t),getOldValue:t=>getOldValue(a,t),lock:t=>lock(a,t),setViewMode:t=>setViewMode(a,t),isInViewMode:()=>isInViewMode(a),fill:t=>fill(a,t),commit:()=>commit(a),reset:()=>reset(a),isDataChanged:()=>isDataChanged(a),getData:()=>getData(a),save:(t,e)=>save(a,t,e),createnew:t=>createnew(a,t),canceledit:t=>canceledit(a,t),isNewData:()=>isNewData(a),markNewData:t=>markNewData(a,t),markDataChanged:()=>{a.datachanged=!0},dataload:(t,e,o)=>{dataload(a,t,e,o)},CreateRecordStatusPage:t=>{CreateRecordStatusPage(a,t)},CreateLogPage:t=>{CreateLogPage(a,t)},btn_save_click:()=>{btn_save_click(a)},btn_edit_click:()=>{btn_edit_click(a)},SuspendEvent:t=>suspendevent(a,t),isEventSuspended:()=>iseventsuspended(a),set_state_textbox:(t,e)=>set_state_textbox(a,t,e),addAboutInfo:(t,e)=>{a.customaboutinfo.push({name:t,descr:e})},toBool:t=>1==t,optionalValidation:()=>optionalValidation(a),mandatoryValidation:(t,e,o)=>mandatoryValidation(a,t,e,o)},init(a),a.fgta4form}function init(t){var e=t.options.objects;for(var a in e){let n=e[a];if("txt_editorial_content"==a&&console.log(a),n.name=a,n.mapping=n.attr("mapping"),n.objecttypeclass=getEasyuiClass(t,n),n.isCombo=()=>!1,"easyui-checkbox"==n.objecttypeclass){var o=n.checkbox("options");n.object_isdisabled=o.disabled,n.originalbackground=n.parent().find("span.checkbox").css("background-color"),n.parent().find("svg").find("path").attr("stroke","black"),n.parent().find("span.checkbox-inner.checkbox-checked").removeClass("checkbox-checked")}else if("easyui-texteditor"==n.objecttypeclass);else if(n.hasClass("easyui-combo")){o=n.combo("options");n.object_isdisabled=o.disabled,n.originalbackground=n.textbox("textbox").css("background"),n.display=n.attr("display"),n.colorbase=n.css("color"),n.revalidate=e=>{var a=n.combo("options"),o=n.combo("getValue"),i=n.combo("getText");e=Object.assign(a,e);n.combo(e);var s=t.fgta4form.getDefaultPrompt(!0),r=t.fgta4form.getDefaultPrompt(!1);(e.required&&i==r.text||!e.required&&i==s.text)&&(i=e.prompt),t.fgta4form.setValue(n,o,i),t.fgta4form.setDisable(n,a.disabled)}}else{o=n.textbox("options");n.object_isdisabled=o.disabled,n.originalbackground=n.textbox("textbox").css("background"),n.revalidate=e=>{var a=n.textbox("options"),o=n.textbox("getText");e=Object.assign(a,e);n.textbox(e),t.fgta4form.setDisable(n,a.disabled),t.fgta4form.setValue(n,o)}}n.currentValue="",n.currentDisplay="",n.chekpointData={value:n.currentValue,display:n.currentDisplay},void 0===t.MAPPING[n.mapping]?t.MAPPING[n.mapping]=[n]:t.MAPPING[n.mapping].push(n),t.ITEMS[a]=n,n.form=t.fgta4form}CreateRecordStatusPage(t,"pnl_edit"),CreateLogPage(t,"pnl_edit"),CreateAboutPage(t,"pnl_edit"),setTimeout((()=>{$.parser.parse("#"+t.form.attr("id"));var e=t.options.objects;for(var a in e){var o=e[a];if("easyui-texteditor"==o.objecttypeclass);else if("easyui-checkbox"!==o.objecttypeclass){var n=o.textbox("textbox");void 0!==o.attr("maxlength")&&$(n).attr("maxlength",o.attr("maxlength")),void 0!==o.attr("uppercase")?"true"===o.attr("uppercase").toLowerCase()&&$(n).css("text-transform","uppercase"):void 0!==o.attr("lowercase")&&"true"===o.attr("lowercase").toLowerCase()&&$(n).css("text-transform","lowercase")}}t.OnFormInit()}),500)}function CreateLogPage(t,e){if(null!=document.getElementById(e)){if(void 0===t.options.logview)return void console.log("log view belum didefinisi pada form, record log tidak ditampilkan.");setTimeout((()=>{var a=e+"_log";if(void 0===$ui.getPages().ITEMS[a]){var o={};$ui[`loaddata_${a}`]=()=>{var e=`${global.modulefullname.split("/")[0]}/framework/general/loglist`,a=t.primary.textbox("getValue");o.clear();o.listload((async o=>{o.api=e,o.criteria.tablename=t.options.logview,o.criteria.id=a}),(async(t,e)=>{}))},$ui[`show_${a}`]=()=>{$ui.getPages().show(a,(()=>{$ui[`loaddata_${a}`]()}))},t.LoaddataLog=$ui[`loaddata_${a}`],t.ShowLog=$ui[`show_${a}`],$(`#${e}`).append(`<div name="fgta-record-log" class="fgta-recordstatus-button" style="margin-top: 5px; margin-right: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border-left: 1px solid #666; border-right: 0px solid #333; display: inline-block">\n\t\t\t\t\t\t<a href="javascript:void(0)" onclick="$ui['show_${a}']()">Log</a>\n\t\t\t\t\t</div>`),$(`<div id="${a}">\n\t\t\t\t\t\t<div class="fgta-page-title" style="display: flex; align-items: center ">\n\t\t\t\t\t\t\tRecord Log\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div style="margin-top: 10px">\n\t\t\t\t\t\t\t<table id="${a}-tbl_list" paging="true" cellspacing="0" width="100%">\n\t\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<th mapping="timestamp">timestamp</th>\n\t\t\t\t\t\t\t\t\t\t<th mapping="user_name">user_name</th>\n\t\t\t\t\t\t\t\t\t\t<th mapping="action">action</th>\n\t\t\t\t\t\t\t\t\t\t<th mapping="remoteip">remoteip</th>\n\t\t\t\t\t\t\t\t\t\t<th mapping="module">module</th>\n\t\t\t\t\t\t\t\t\t\t<th mapping="note">note</th>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr style="background-color: #cccccc; height: 30px">\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">Time</td>\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">User</td>\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">Action</td>\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">IP</td>\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">Module</td>\n\t\t\t\t\t\t\t\t\t\t<td class="fgtable-head" style="width: 100px; border-bottom: 1px solid #000000">Note</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\n\t\t\t\t\t</div>\n\t\t\t\t`).insertAfter(`#${e}`);var n=$(`#${a}-tbl_list`),i=$(`#${a}`);i.hide();var s={panel:i,handler:{init:async t=>{}}};s.panel.id=a,s.panel.pagenum=Object.keys($ui.getPages().ITEMS).length+1,s.panel.handler=s.handler,$ui.getPages().ITEMS[a]=s.panel,o=new global.fgta4grid(n,{}),document.addEventListener("OnButtonBack",(t=>{$ui.getPages().getCurrentPage()==a&&(t.detail.cancel=!0,$ui.getPages().show(e))}))}}),1e3)}}function CreateRecordStatusPage(t,e){null!=document.getElementById(e)&&setTimeout((()=>{var a=e+"_record";if(void 0===$ui.getPages().ITEMS[a]){$ui[`set_${a}`]=e=>{null!=e&&Object.assign(t.recordstatus,{_createby:e._createby,_createby_username:e._createby_username,_createdate:e._createdate,_modifyby:e._modifyby,_modifyby_username:e._modifyby_username,_modifydate:e._modifydate}),$(`#${a}-createby`).html(null!=t.recordstatus._createby_username?t.recordstatus._createby_username:t.recordstatus._createby),$(`#${a}-createdate`).html(t.recordstatus._createdate),$(`#${a}-modifyby`).html(null!=t.recordstatus._modifyby_username?t.recordstatus._modifyby_username:t.recordstatus._modifyby),$(`#${a}-modifydate`).html(t.recordstatus._modifydate)},$ui[`show_${a}`]=()=>{$ui[`set_${a}`](),$ui.getPages().show(a)},t.SetRecord=$ui[`set_${a}`],t.ShowRecord=$ui[`show_${a}`],$(`#${e}`).append(`<div name="fgta-record-status" class="fgta-recordstatus-button" style="margin-top: 5px; margin-right: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border-left: 0px solid #999; border-right: 0px solid #333;  display: inline-block">\n\t\t\t\t\t\t<a href="javascript:void(0)" onclick="$ui['show_${a}']()">Record Status</a>\n\t\t\t\t\t</div>`),$(`<div id="${a}">\n\t\t\t\t\t<div class="fgta-page-title" style="display: flex; align-items: center ">\n\t\t\t\t\t\tRecord Status\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="margin-bottom: 30px">\n\t\t\t\t\t\t<div class="form_row">\n\t\t\t\t\t\t\t<div class="form_label_col">Create By</div>\n\t\t\t\t\t\t\t<div class="form_input_col" style="border: 0px solid black">\n\t\t\t\t\t\t\t\t<span id="${a}-createby"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\t<div class="form_row">\n\t\t\t\t\t\t\t<div class="form_label_col">Create Date</div>\n\t\t\t\t\t\t\t<div class="form_input_col" style="border: 0px solid black">\n\t\t\t\t\t\t\t\t<span id="${a}-createdate"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\t<div class="form_row" style="margin-top: 30px">\n\t\t\t\t\t\t\t<div class="form_label_col">Modify By</div>\n\t\t\t\t\t\t\t<div class="form_input_col" style="border: 0px solid black">\n\t\t\t\t\t\t\t\t<span id="${a}-modifyby"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\t<div class="form_row">\n\t\t\t\t\t\t\t<div class="form_label_col">Modify Date</div>\n\t\t\t\t\t\t\t<div class="form_input_col" style="border: 0px solid black">\n\t\t\t\t\t\t\t\t<span id="${a}-modifydate"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t</div>\n\t\t\t\n\t\t\t\t</div>`).insertAfter(`#${e}`);var o=$(`#${a}`);o.hide();var n={panel:o,handler:{init:async t=>{}}};n.panel.id=a,n.panel.pagenum=Object.keys($ui.getPages().ITEMS).length+1,n.panel.handler=n.handler,$ui.getPages().ITEMS[a]=n.panel,document.addEventListener("OnButtonBack",(t=>{$ui.getPages().getCurrentPage()==a&&(t.detail.cancel=!0,$ui.getPages().show(e))}))}t.OnRecordStatusCreated()}),1e3)}function CreateAboutPage(t,e){null!=document.getElementById(e)&&setTimeout((()=>{var a=e+"_about";if(void 0===$ui.getPages().ITEMS[a]){$ui[`show_${a}`]=()=>{$ui.getPages().show(a)};var o=[];o.push({name:"Base Title",descr:document.getElementsByName("basetitle")[0].getAttribute("content")}),o.push({name:"Program Name",descr:document.title}),o.push({name:"Modul Fullname",descr:document.getElementsByName("modulefullname")[0].getAttribute("content")}),o.push({name:"Variance",descr:document.getElementsByName("variancename")[0].getAttribute("content")}),o.push({name:"Author",descr:$("meta[name='author']").attr("content")}),o.push({name:"Program Create Date",descr:$("meta[name='createdate']").attr("content")});var n="";for(var i of o){var s=i.descr.replace("https://www.fgta.net",'<a href="https://www.fgta.net/">https://www.fgta.net</a>');n+=`<div  class="pabout-line" style="display: flex">\n\t\t\t\t\t\t<div class="pabout-line-title" >${i.name}</div>\n\t\t\t\t\t\t<div class="pabout-line-descr">${s}</div>\n\t\t\t\t\t</div>`}var r="";for(var d of t.customaboutinfo)r+=`<div class="pabout-line" style="display: flex;">\n\t\t\t\t\t\t<div class="pabout-line-title" >${d.name}</div>\n\t\t\t\t\t\t<div class="pabout-line-descr">${d.descr}</div>\n\t\t\t\t\t</div>`;$(`#${e}`).append(`<div name="fgta-record-about" class="fgta-recordstatus-button" style="margin-top: 5px; margin-right: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border-left: 1px solid #999; border-right: 0px solid #333;  display: inline-block">\n\t\t\t\t\t\t<a href="javascript:void(0)" onclick="$ui['show_${a}']()">About</a>\n\t\t\t\t\t</div>`),$(`<div id="${a}">\n\t\t\t\t\t<div class="fgta-page-title" style="display: flex; align-items: center ">\n\t\t\t\t\t\tAbout\n\t\t\t\t\t</div>\n\t\t\t\t\t<div name="default" class="pabout-box" style="margin-bottom: 30px">\n\t\t\t\t\t\t${n}\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div name="custom"  class="pabout-box" style="margin-bottom: 30px">\n\t\t\t\t\t\t${r}\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t</div>`).insertAfter(`#${e}`);var l=$(`#${a}`);l.hide();var c={panel:l,handler:{init:async t=>{}}};c.panel.id=a,c.panel.pagenum=Object.keys($ui.getPages().ITEMS).length+1,c.panel.handler=c.handler,$ui.getPages().ITEMS[a]=c.panel,document.addEventListener("OnButtonBack",(t=>{$ui.getPages().getCurrentPage()==a&&(t.detail.cancel=!0,$ui.getPages().show(e))}))}t.OnRecordStatusCreated()}),1e3)}function setValue(t,e,a,o){if("easyui-checkbox"==e.objecttypeclass)!0===a||1===a||"1"===a?e.checkbox("check"):e.checkbox("uncheck");else if("easyui-combobox"==e.objecttypeclass){var n=e.combobox("getData"),i=n.find((t=>t[e.valueField]===a));void 0===i&&((i={})[e.valueField]=a,i[e.textField]=o,n.push(i),e.combobox("loadData",n)),e.combobox("setValue",a)}else if("easyui-numberbox"==e.objecttypeclass)e.numberbox("setValue",a);else if("easyui-filebox"==e.objecttypeclass){e.filebox("textbox")[0].value=a}else"easyui-combo"==e.objecttypeclass?(e.combo("setValue",a),void 0!==o&&e.combo("setText",o)):e.textbox("setValue",a);return e.currentValue=a,e.currentDisplay=o,t.fgta4form}function getValue(t,e){return"easyui-checkbox"==e.objecttypeclass?e.checkbox("options").checked:"easyui-combobox"==e.objecttypeclass?e.combobox("getValue"):"easyui-filebox"==e.objecttypeclass?e.filebox("textbox")[0].value:e.textbox("getValue")}function getOldValue(t,e){return e.chekpointData.value}function getEasyuiClass(t,e){return e.hasClass("easyui-textbox")?"easyui-textbox":e.hasClass("easyui-checkbox")?"easyui-checkbox":e.hasClass("easyui-datebox")?"easyui-datebox":e.hasClass("easyui-numberbox")?"easyui-numberbox":e.hasClass("easyui-combobox")?"easyui-combobox":e.hasClass("easyui-combo")?"easyui-combo":e.hasClass("easyui-filebox")?"easyui-filebox":e.hasClass("easyui-texteditor")?"easyui-texteditor":void 0}function isDataChanged(t){return t.datachanged}function lock(t,e){return!1===e?t.buttons.edit.linkbutton("enable"):t.buttons.edit.linkbutton("disable"),t.fgta4form}function isInViewMode(t){return t.inviewmode}function setViewMode(t,e){for(var a in(e=!1!==e)?(t.buttons.edit.linkbutton("unselect"),t.buttons.save.linkbutton("disable"),t.buttons.delete.linkbutton("disable")):(t.buttons.edit.linkbutton("select"),t.buttons.save.linkbutton("enable"),t.buttons.delete.linkbutton("enable")),t.ITEMS){var o=t.ITEMS[a];"easyui-checkbox"==o.objecttypeclass?set_state_checkbox(t,o,e):set_state_textbox(t,o,e)}return t.OnViewModeChanged(e),t.inviewmode=e,t.fgta4form}function form_changed(t){t.datachanged||(t.datachanged=!0)}function btn_delete_click(t){var e=$(window).scrollTop(),a=t.errordiv;if(!isNewData(t)){$(`#${a}`).remove();var o={};remove(t,o,(async(n,i)=>{if(null!=i&&!1===i.success&&(n={message:i.errormessage}),n){var s=n.message.replace(/\[ERROR\]|\[WARNING\]|\[QUESTION\]|\[INFO\]/,"");$(`<div id="${a}" class="fgform-errorbox" style="visibility: hidden; padding: 5px 5px 5px 5px;"><div style="font-weight:bold; color:red; margin-bottom: 5px;">Error on Delete !</div>${s}</div>`).insertAfter(t.buttons.save),$(window).scrollTop(e),setTimeout((()=>{$(`#${a}`).css("visibility","visible"),$ui.unmask()}),500),console.log(n)}else $ui.unmask(null,(async()=>{o.savedmessage="Data berhasil dihapus",await t.OnDataDeleted(i,o),!0!==o.suppressdialog&&$ui.ShowMessage(o.savedmessage)}))}))}}function btn_save_click(t){var e=$(window).scrollTop(),a=t.errordiv;for(var o in t.ITEMS){"easyui-checkbox"==(n=t.ITEMS[o]).objecttypeclass||n.textbox("textbox")[0]===document.activeElement&&(t.focustextbox=n,n.textbox("textbox").blur())}if(t.fgta4form.isDataChanged()){try{for(var o in t.ITEMS){var n;if("easyui-checkbox"==(n=t.ITEMS[o]).objecttypeclass);else if(!n.textbox("isValid")){var i=n.textbox("options");throw $ui.ShowMessage("[WARNING]"+i.invalidMessage,{OK:()=>{n.textbox("textbox").focus()}}),i.invalidMessage}}}catch(t){return}var s=$ui.mask("saving data ...");$(`#${a}`).remove();var r={};save(t,s,r,(async(o,n)=>{if(console.log(n),o){var i=o.message.replace(/\[ERROR\]|\[WARNING\]|\[QUESTION\]|\[INFO\]/,"");$(`<div id="${a}" class="fgform-errorbox" style="visibility: hidden; padding: 5px 5px 5px 5px;"><div style="font-weight:bold; color:red; margin-bottom: 5px;">Error !</div>${i}</div>`).insertAfter(t.buttons.save),$(window).scrollTop(e),setTimeout((()=>{$(`#${a}`).css("visibility","visible"),$ui.unmask(s)}),500),await t.OnDataSaveError(o,r)}else $ui.unmask(s,(async()=>{r.savedmessage="Data berhasil disimpan",t.OnIdSetup({action:"save"}),await t.OnDataSaved(n,r),commit(t),markNewData(t,!1),!0!==r.suppressdialog&&$ui.ShowMessage("[INFO]"+r.savedmessage,{Ok:()=>{null!=t.focustextbox&&t.focustextbox.textbox("textbox").focus()}})}))}))}else null!=t.focustextbox&&t.focustextbox.textbox("textbox").focus()}function canceledit(t,e){var a=t.fgta4form.getDataChangeMessage();$ui.ShowMessage(a,{Ya:()=>{reset(t),setViewMode(t,!0),"function"==typeof t.fgta4form.OnDataCanceled&&t.fgta4form.OnDataCanceled(),t.OnNewDataCanceled(),"function"==typeof e&&e()},Tidak:()=>{t.buttons.edit.linkbutton("select")}})}function btn_edit_click(t){var e=!t.buttons.edit.linkbutton("options").selected;1==e&&t.fgta4form.isDataChanged()?canceledit(t):setViewMode(t,e)}function set_state_checkbox(t,e,a){e.object_isdisabled?e.checkbox("disable"):a?(e.checkbox("disable"),e.parent().find("span.checkbox.inputbox.checkbox-checked").removeClass("checkbox-checked"),e.parent().find("span.checkbox.inputbox").addClass("input-modeview"),e.parent().find("span.checkbox.inputbox").removeClass("input-modeedit")):(e.checkbox("enable"),e.parent().find("span.checkbox.inputbox").addClass("input-modeedit"),e.parent().find("span.checkbox.inputbox").removeClass("input-modeview"))}function set_state_textbox(t,e,a){var o=e.textbox("getValue"),n=e.textbox("getText"),i=!!e.hasClass("easyui-combo"),s=!!e.hasClass("easyui-filebox"),r=e.textbox("options");if(e.object_isdisabled||r.disabled)e.textbox("textbox").removeClass("input-modeedit"),e.textbox("textbox").removeClass("input-modeview"),e.textbox("textbox").css("background-color","");else if(a){if(e.textbox("readonly",!0),e.textbox("textbox").addClass("input-modeview"),e.textbox("textbox").removeClass("input-modeedit"),e.hasClass("easyui-numberbox"))e.numberbox("fix");else if(s){var d=e.filebox("textbox");$(d).attr("disabled",!0),e.filebox("button").hide()}}else{if(e.textbox("readonly",!1),i){d=e.combo("textbox");$(d).attr("readonly",!0),d.css("color",e.colorbase)}else if(s){e.filebox("button").show()}e.textbox("textbox").addClass("input-modeedit"),e.textbox("textbox").removeClass("input-modeview")}if(e.parent().find(".textbox-text").each((function(){var t=$(this).parent();0!=t.width()&&(i?$(this).width(t.width()-33):($(this).css("padding-right","10px"),$(this).width(t.width()-10)))})),n!=o)if(s){d=e.combo("textbox");console.log(n,o)}else e.textbox("setValue",o),e.textbox("setText",n)}function fill(t,e){for(var a in t.ITEMS){var o=t.ITEMS[a];if(e.hasOwnProperty(o.mapping)){var n=e.hasOwnProperty(o.display)?e[o.display]:e[o.mapping];setValue(t,o,e[o.mapping],n)}}return t.OnIdSetup({action:"fill"}),markNewData(t,!1),t.fgta4form}function commit(t){for(var e in t.ITEMS){var a=t.ITEMS[e];a.chekpointData={value:a.currentValue,display:a.currentDisplay}}return t.datachanged=!1,t.fgta4form}function reset(t){for(var e in t.ITEMS){var a=t.ITEMS[e],o=a.chekpointData;setValue(t,a,o.value,o.display)}return t.datachanged=!1,t.fgta4form}function getData(t){var e={},a={};for(var o in t.ITEMS){var n=t.ITEMS[o];if("easyui-filebox"==n.objecttypeclass){var i=n.filebox("files");a[n.mapping]=i[0]}e[n.mapping]=getValue(t,n)}return e.FILES=a,t.OnGettingData(e),e}async function save(t,e,a,o){var n=Object.assign({api:`${global.modulefullname}/save`,cancel:!1,autoid:t.fgta4form.autoid},a),i=t.fgta4form.getData(),s=i.FILES;if(delete i.FILES,await t.OnDataSaving(i,n),1==n.cancel)return console.log("save canceled"),void $ui.unmask(e);null==n.skipmappingresponse&&(n.skipmappingresponse=[]),i._state=isNewData(t)?"NEW":"MODIFY";var r={data:i,options:n},d=n.api;try{let e=await $ui.apicall(d,r,s);if(void 0!==e.dataresponse){for(var l in e.dataresponse)if(void 0!==t.MAPPING[l])for(var c of t.MAPPING[l])n.skipmappingresponse.includes(c.mapping)||(null!=c.display&&null!=e.dataresponse[c.display]?setValue(t,c,e.dataresponse[l],e.dataresponse[c.display]):setValue(t,c,e.dataresponse[l]));Object.assign(t.recordstatus,{_createby:e.dataresponse._createby,_createby_username:e.dataresponse._createby_username,_createdate:e.dataresponse._createdate,_modifyby:e.dataresponse._modifyby,_modifyby_username:e.dataresponse._modifyby_username,_modifydate:e.dataresponse._modifydate})}if("function"!=typeof o)return e;await o(null,e,n)}catch(t){if("function"!=typeof o)throw new Error(t);o(t,null,n)}}async function remove(t,e,a){var o=t.fgta4form.getData(),n=o[t.fgta4form.primary.mapping],i=Object.assign({api:`${global.modulefullname}/delete`,cancel:!1,confirmationmessage:`<div>Apakah anda yakin akan <b>menghapus</b> data '${n}' ?</div>`,noconfirm:!1},e);await t.OnDataDeleting(o,i);if(!i.noconfirm&&await(async t=>new Promise(((e,a)=>{$ui.ShowMessage(t,{Yes:()=>{e(!1)},Cancel:()=>{e(!0)}})})))(i.confirmationmessage))return;if($ui.mask("removing data ..."),1==i.cancel)return console.log("delete canceled"),void $ui.unmask();var s={data:o,options:i},r=i.api;try{let t=await $ui.apicall(r,s);if("function"!=typeof a)return t;await a(null,t,i)}catch(t){if("function"!=typeof a)throw new Error(t);a(t,null,i)}}async function createnew(t,e){var a={},o={autoid:!0};for(var n in t.ITEMS){a[(s=t.ITEMS[n]).mapping]=null}for(var i in e(a,o),"function"==typeof o.OnCanceled&&t.OnNewDataCanceled!=o.OnCanceled&&(t.OnNewDataCanceled=o.OnCanceled),t.ITEMS){var s;if((s=t.ITEMS[i]).hasClass("easyui-combobox")||s.hasClass("easyui-combo"))void 0!==s.display?setValue(t,s,a[s.mapping],a[s.display]):setValue(t,s,a[s.mapping]);else if(s.hasClass("easyui-filebox")){var r=s.filebox("textbox");$(r).attr("disabled",!0),setValue(t,s,a[s.mapping])}else setValue(t,s,a[s.mapping])}t.OnIdSetup({action:"createnew"}),"function"==typeof t.SetRecord&&t.SetRecord({_createby:"",_createby_username:"",_createdate:new Date,_modifyby:"",_modifyby_username:"",_modifydate:""}),"function"==typeof o.OnNewData&&o.OnNewData(a);var d=t.errordiv;return $(`#${d}`).remove(),t.buttons.edit.linkbutton("enable"),setViewMode(t,!1),commit(t),markNewData(t,!0),t.datachanged=!0,t.fgta4form}function isNewData(t){return t.isnewdata}function markNewData(t,e){t.isnewdata=e,e?t.buttons.delete.linkbutton("disable"):t.buttons.delete.linkbutton("enable")}async function dataload(t,e,a,o){var n={api:`${global.modulefullname}/open`,criteria:{}};"function"==typeof e&&e(n);var i={options:n},s=n.api;try{var r=t.errordiv;$(`#${r}`).remove();var d=$ui.mask("opening data...");let e=await $ui.apicall(s,i);if($ui.unmask(d),void 0===e.record)throw"Record tidak ditemukan";Object.assign(t.recordstatus,{_createby:e.record._createby,_createby_username:e.record._createby_username,_createdate:e.record._createdate,_modifyby:e.record._modifyby,_modifyby_username:e.record._modifyby_username,_modifydate:e.record._modifydate}),"function"==typeof a&&a(e,n)}catch(t){$ui.unmask(),"function"==typeof o&&o(t)}}function suspendevent(t,e){return t.eventsuspended=e,t.fgta4form}function iseventsuspended(t){return t.eventsuspended}function getCurrentId(t){return t.primary.textbox("getValue")}function setDisable(t,e,a=!0){var o=isInViewMode(t),n=a?"disable":"enable";e.hasClass("easyui-textbox")?(e.textbox(n),set_state_textbox(t,e,o)):e.hasClass("easyui-checkbox")?(e.object_isdisabled=a,e.checkbox(n),set_state_checkbox(t,e,o)):e.hasClass("easyui-datebox")?(e.datebox(n),set_state_textbox(t,e,o)):e.hasClass("easyui-numberbox")?(e.numberbox(n),set_state_textbox(t,e,o)):e.hasClass("easyui-combobox")?(e.combobox(n),set_state_textbox(t,e,o)):e.hasClass("easyui-combo")?(e.combo(n),set_state_textbox(t,e,o)):e.hasClass("easyui-filebox")?(e.filebox(n),set_state_textbox(t,e,o)):e.hasClass("easyui-texteditor")&&e.texteditor(n)}function optionalValidation(t){var e=t.fgta4form.getDefaultPrompt(!1);return{required:!1,invalidMessage:null,prompt:e.text,defaultvalue:e.value,defaulttext:e.text,validType:null}}function mandatoryValidation(t,e,a,o){var n=t.fgta4form.getDefaultPrompt(!1),i=`requiredcombo['${e}']`;return void 0!==o&&(i=o),{required:!0,invalidMessage:a,prompt:t.fgta4form.getDefaultPrompt(!0).text,defaultvalue:n.value,defaulttext:n.text,validType:i}}